/* comm.js @ https://www.github.com/jas-/comm.js */
(function(b,c){var a=a||function(i,e){var h={async:true,binary:false,data:false,headers:{},interval:3600,method:"get",timeout:10,url:""};var d=d||{init:function(l,k){f.handle(l,k)}};var f=f||{online:function(){return navigator.onLine},handle:function(l,k){if(!this.online()){var m=setInterval(function(o,n){this.mode(o,n)},l.interval);clearInterval(m)}else{this.mode(l,k)}},mode:function(m,k){var l=new RegExp(document.location.href);if((/msie/i.test(navigator.userAgent))&&(/^(http|https):\/\//i.test(m.url))&&(!l.test(m.url))&&(/msie (\d+)/i.exec(navigator.userAgent)[1]>10)){return this.xdr(m,k)}if(/^(ws|wss):\/\//i.test(m.url)){return this.websocket(m,k)}return this.ajax(m,k)},websocket:function(m,k){var l=new WebSocket(m.url);l.onopen=function(){try{l.send(m.data)}catch(n){k(n)}};l.onmessage=function(n){l.close();k(null,n.data)}},xdr:function(n,k){var m=false;if(!b.XDomainRequest){k("XDomainRequest object not found")}var l=new XDomainRequest();l.timeout=n.timeout;l.open(n.method,n.url);l.onsuccess=function(o){m=o};l.onerror=function(o){k(o)};l.send(n.data);k(null,m)},ajax:function(o,k){var q=new XMLHttpRequest(),n=new RegExp(document.location.href);function l(r){k(o.errcallback(r.status))}function m(){if(q.readyState==4&&q.status==200){k(null,q.responseText)}}function p(s){if(g.parse(s.data)){q.setRequestHeader("Content-Type","application/json");s.data=JSON.stringify(s.data)}if(Object.keys(s).length>0){for(var r in s.headers){q.setRequestHeader(r,s.headers[r])}}if(!n.test(s.url)){q.withCredentials=true}}q.onreadystatechange=m;q.open(o.method,o.url,o.async);p(o);if(o.binary){q.sendAsBinary(o.data)}else{q.send(o.data)}}};var g=g||{merge:function(m,l){m=m||{};for(var k in m){if(m.hasOwnProperty(k)){l[k]=(/object/.test(typeof(m[k])))?this.merge(l[k],m[k]):m[k]}l[k]=m[k]}return l},parse:function(m){var k=false;try{(/object/.test(m))?JSON.parse(m):JSON.stringify(m)}catch(l){k=true}return k}};var j=function(){e=e||i;var k=g.merge(i,h);d.init(k,e)}()};b.comm=a})(window);
