/* comm.js @ https://www.github.com/jas-/comm.js */
(function(e,t){"use strict";var n=n||function(t,n){var r={async:true,data:false,interval:3600,method:"get",timeout:10,url:""};var i=i||{init:function(e,t){s.handle(e,t)}};var s=s||{online:function(){return navigator.onLine},handle:function(e,t){if(!this.online()){var n=setInterval(function(e,t){this.mode(e,t)},e.interval);clearInterval(n)}else{this.mode(e,t)}},mode:function(e,t){var n=new RegExp(document.location.href);if(/msie/i.test(navigator.userAgent)&&/^(http|https):\/\//i.test(e.url)&&!n.test(e.url)){return this.xdr(e,t)}if(/^(ws|wss):\/\//i.test(e.url)){return this.websocket(e,t)}return this.ajax(e,t)},websocket:function(e,t){var n=new WebSocket(e.url);n.onopen=function(){try{n.send(e.data)}catch(r){t(r)}};n.onmessage=function(e){n.close();t(null,e.data)}},xdr:function(t,n){var r=false;if(!e.XDomainRequest)n("XDomainRequest object not found");var i=new XDomainRequest;i.timeout=t.timeout;i.open(t.method,t.url);i.onsuccess=function(e){r=e};i.onerror=function(e){n(e)};i.send(t.data);n(null,r)},ajax:function(e,t){function s(n){t(e.errcallback(n.status))}function u(){if(this.readyState==4&&this.status==200){t(null,this.responseText)}}function a(){if(/put|post/.test(e.method))r.setRequestHeader("Content-type","application/x-www-form-urlencoded");if(!i.test(e.url))r.withCredentials=true;if(o.parse(e.data)){r.setRequestHeader("Content-Type","application/json");e.data=JSON.stringify(e.data)}}var n=false,r=new XMLHttpRequest,i=new RegExp(document.location.href);r.onreadystatechange=u;r.open(e.method,e.url,e.async);a();r.send(e.data)}};var o=o||{merge:function(e,t){e=e||{};for(var n in e){if(e.hasOwnProperty(n)){t[n]=/object/.test(typeof e[n])?this.merge(t[n],e[n]):e[n]}t[n]=e[n]}return t},parse:function(e){var t=false;try{/object/.test(e)?JSON.parse(e):JSON.stringify(e)}catch(n){t=true}return t}};var u=function(){n=n||t;var e=o.merge(t,r);i.init(e,n)}()};e.comm=n})(window)
