/* comm.js @ https://www.github.com/jas-/comm.js */
(function(e,t){"use strict";var n=n||function(t){var n={async:true,data:false,method:"get",interval:3600,timeout:10,url:"",callback:function(){},precallback:function(){},errcallback:function(){}};var r=r||{init:function(e){return i.mode(e)}};var i=i||{online:function(){return navigator.onLine},retry:function(e){var t=setInterval(function(e){if(this.online){this.mode(e)}else{this.retry(e)}},e.interval);clearInterval(t);return true},mode:function(e){var t=new RegExp(document.location.href);if(e.precallback&&/function/.test(typeof e.precallback)){e.precallback(this)}if(/msie/i.test(navigator.userAgent)&&/^(http|https):\/\//i.test(e.url)&&!t.test(e.url)){this.xdr(e)}if(/^(ws|wss):\/\//i.test(e.url)){this.websocket(e)}this.ajax(e);if(e.callback&&/function/.test(typeof e.callback)){e.callback(this)}return true},websocket:function(e){var t=false,n=new WebSocket(e.url);n.onopen=function(){try{n.send(e.data)}catch(t){throw t}};n.onmessage=function(e){t=e.data;n.close()};return t},xdr:function(t){var n=false;if(!e.XDomainRequest)throw"XDomainRequest object not found";var r=new XDomainRequest;r.timeout=t.timeout;r.open(t.method,t.url);r.onsuccess=function(e){n=r.responseText};r.onerror=function(e){throw e};r.send(t.data);return n},ajax:function(e){function i(e){t=e.responseText}function s(e){throw e.status}function o(){if(this.readyState==this.DONE&&this.status==200){i(this.responseText)}}function u(){if(!r.test(e.url))n.withCredentials=true}var t=false,n=new XMLHttpRequest,r=new RegExp(document.location.href);n.onreadystatechange=o;n.open(e.method,e.url,e.async);u();n.send(/post|put/i.test(e.method)?e.data:null);return t}};var s=s||{merge:function(e,t){e=e||{};for(var n in e){if(e.hasOwnProperty(n)){t[n]=/object/.test(typeof e[n])?this.merge(t[n],e[n]):e[n]}t[n]=e[n]}t.logID=t.appID;return t}};var o=function(){var e=s.merge(t,n);r.init(e);return true}()};e.comm=n})(window)
