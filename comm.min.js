/* comm.js @ https://www.github.com/jas-/comm.js */
(function(e,t){"use strict";var n=n||function(t){var n={appID:"comm.js",url:"",data:false,debug:false,async:true,method:"get",logID:"",callback:function(){},precallback:function(){},errcallback:function(){}};var r=r||{init:function(e){this.go(e)},go:function(e){if(i.online()){i.decide(e,e.url)}else{return'{error:"Network connectivity not present"}'}return e.data}};var i=i||{online:function(){return navigator.onLine},retry:function(e,t,n){var r=10,i=0;var s=setInterval(function(e,t,n){this.online?this.decide(e,t,n):false},3600);clearInterval(s);return true},decide:function(e,t){var n=new RegExp(document.location.href);if(/msie/i.test(navigator.userAgent)&&/^(http|https):\/\//i.test(e.url)&&!n.test(e.url)){return this.online?this.xdr(e,e.data,t):this.retry(e,e.data,t)}if(/^(ws|wss):\/\//i.test(e.url)){return this.online?this.websocket(e,e.data,t):this.retry(e,e.data,t)}return this.online?this.ajax(e,e.data,t):this.retry(e,e.data,t)},websocket:function(e){var t=false,n=new WebSocket(e.url);e.debug?o.debug(e.logID,"_comm.websocket: Status: "+n.readyState):false;n.onopen=function(){try{n.send(e.data);e.debug?o.debug(e.logID,"_comm.websocket: Sent: "+e.data):false}catch(t){o.error(e.logID,"_comm.websocket: Error => "+t)}};n.onmessage=function(r){e.debug?o.debug(e.logID,"_comm.websocket: Receieved: "+r.data):false;t=r.data;n.close()};n.onclose=function(){e.debug?o.debug(e.logID,"_comm.websocket: Status: "+n.readyState):false};return t},xdr:function(t,n,r){var i=false;if(!e.XDomainRequest){o.error(t.logID,"_comm.xdr: Error => The XDR functionality for your browser was not found.");return false}var s=new XDomainRequest;s.timeout=100;s.open("post",t.url+"?cmd="+r);s.onsuccess=function(e){t.debug?o.debug(t.logID,"_libs.xdr: "+s.responseText):false;i=s.responseText};s.onerror=function(e){o.error(t.logID,"_libs.xdr: Error => "+e)};s.send(n);return i},ajax:function(e,t,n){function a(e){r=e.responseText}function f(e){r=e.status}function l(){if(this.readyState==this.DONE&&this.status==200){a(this.responseText)}}function c(e){if(!u.test(e.url))s.withCredentials=true;e.precallback&&/function/.test(typeof e.precallback)?e.precallback(this):false;e.debug?o.debug(e.logID,"_comm.ajax: Set request headers"):false}var r=false,i=false,s=false,u=new RegExp(document.location.href);s=new XMLHttpRequest;s.onreadystatechange=l;s.open(e.method,e.url,e.async);c(e);s.send(/post|put/i.test(e.method)?e.data:null);return r}};var s=s||{merge:function(e,t){e=e||{};for(var n in e){if(e.hasOwnProperty(n)){t[n]=/object/.test(typeof e[n])?this.merge(t[n],e[n]):e[n]}t[n]=e[n]}t.logID=t.appID;t.debug?o.debug(t.logID,"_libs.merge: Merged options"):false;return t}};var o=o||{debug:function(e,t){/function/i.test(typeof console.debug)?console.debug("["+e+"] (DEBUG) "+t):false},info:function(e,t){/function/i.test(typeof console.info)?console.info("["+e+"] (DEBUG) "+t):false},warn:function(e,t){/function/i.test(typeof console.warn)?console.warn("["+e+"] (DEBUG) "+t):false},error:function(e,t){/function/i.test(typeof console.error)?console.error("["+e+"] (DEBUG) "+t):false}};var u=function(){var e=s.merge(t,n);if(!r.init(e)){return false}return true}()};e.comm=n})(window)
